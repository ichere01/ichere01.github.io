<!DOCTYPE html>

<html>

  <head>
    <title>MMap</title>
    <link rel="stylesheet" href="map_style.css">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?sensor=true&amp;libraries=places"></script>

    
     <script>
      

      var myLat = 10;
      var myLng = 10;
      myOptions = {
            zoom: 12, 
            center: new google.maps.LatLng(myLat, myLng),
            mapTypeId: google.maps.MapTypeId.ROADMAP
          };
      var map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
      //getMyLocation(myLat, myLng);
 
      function initialize()
      {
         // var myOptions = {
         //    zoom: 12, 
         //    center: new google.maps.LatLng(myLat, myLng),
         //    mapTypeId: google.maps.MapTypeId.ROADMAP
         //  };
      
        //var map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
        image = 'dollar-sign.jpg'
        addMyLocation(myLat, myLng, map,image);
       // get_positions(data,map);
      }

/****************** XML REQUEST *******************/
      var request = new XMLHttpRequest();
      request.open("POST", "http://chickenofthesea.herokuapp.com/sendLocation", true);
      request.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
      request.send("login=Nanny&lat=" + myLat + "&lng=" + myLng);
      request.onreadystatechange = function (){
        if(request.readyState == 4 && request.status == 200){
          data = JSON.parse(request.responseText);
          console.log(data);
        }
      }
/***************** GETTING CHARACTERS *************/

      function getCharacters () {
        for (i = 0; i < data.length; i++){
          name = data.characters[i].name;
          var lat = data.characters[i].loc.latitude;
          var lng = data.characters[i].loc.longitude;
          var note = data.characters[i].loc.note;
          var info = "latitude:" + lat + " longitude:" + lng + note;
          var image;

          if (name == "carmen")
          {
            image = "carmen.jpg";
          }
          if(name == "hescott")
          {
            image = "hescott.jpg"
          }
          if(name == "nr")
          {
            image = "nr.jpg"
          }
          if(name == "snape")
          {
            image = "snape.jpg"
          }
          if(name == "waldo")
          {
            image = "waldo.jpg"
          }
          if(name == "batman")
          {
            image = "batman.jpg"
          }
          addMarker(map, lat, lng, image, info);
        }
      }






/**************** ADD MY LOCATION ***********/
      function addMyLocation(myLat, myLng, map, image)
      {
        info = "I'm here";
        if (navigator.geolocation) { 
          navigator.geolocation.getCurrentPosition(function(position) {
            myLat = position.coords.latitude;
            myLng = position.coords.longitude;
            addMarker(map, myLat, myLng,image,info);
            var me = new google.maps.LatLng(myLat, myLng);
            map.panTo(me);

          });
        }
        else {
          alert("Geolocation is not supported by your web browser.  What a shame!");
        }
      }
      


      // get_positions(data, map);
      // function get_positions(data, map){
      //   for(i = 0; i < data.TripList.Trips.length; i++){
      //     if(data.TripList.Trips[i].Position != null)
      //     {
      //       lon =  data.TripList.Trips[i].Position.Long;
      //       lat =  data.TripList.Trips[i].Position.Lat;
      //       addMarker(map,lat,lon);
      //     }
      //   }
      // }

      function addMarker(map,lat,lon, image, info){
        var marker = new google.maps.Marker({position: new google.maps.LatLng(lat,lon),
          title: 'Marked',
          map: map,
          icon: image
        });
        var infowindow = new google.maps.InfoWindow({
            content: info
        });
        google.maps.event.addListener(marker, 'click', function() {
          infowindow.open(map,marker);
        });


      }
     
      // var request = new XMLHttpRequest();
      // request.open("get",jsonred,true);
      // console.log(request.responsetext);
      // request.onreadystatechange = function (){
      //   if(request.readyState == 4 && request.status == 200){
      //     data = JSON.parse(request.responsetext);
      //     console.log("hello");
      //   }
      // }
      // request.send();
      
     
    </script>
  </head>
  
  <body onload="initialize()" >
    <div id="map_canvas"></div>
  </body>
</html>